/* xhook - v1.0.8 - https://github.com/jpillora/xhook
* Jaime Pillora <dev@jpillora.com> -  */

(function(){var a,b,c,d,e,f,g,h,i,j,k,l=[].slice,m={}.hasOwnProperty;b="before",a="after",e="readyState",d="Invalid number or parameters. Please see API documentation.",f=["onloadstart","onprogress","onabort","onerror","onload","onloadend"],(k=Array.prototype).indexOf||(k.indexOf=function(a){var b,c,d,e;for(b=d=0,e=this.length;e>d;b=++d)if(c=this[b],c===a)return b;return-1}),c=function(a){var b,c,d;return c={},d=function(a){return c[a]||[]},b={listeners:function(a){return Array.prototype.slice.call(d(a))},on:function(a,b,e){c[a]=d(a),c[a].indexOf(b)>=0||(e=void 0===e?c[a].length:e,c[a].splice(e,0,b))},off:function(a,b){var c;c=d(a).indexOf(b),-1!==c&&d(a).splice(c,1)},fire:function(){var b,c,e,f,g,h;for(c=arguments[0],b=2<=arguments.length?l.call(arguments,1):[],h=d(c),f=0,g=h.length;g>f;f++)e=h[f],e.apply(a,b)}}},i=c(),j={},j[b]=function(a,c){return i.on(b,a,c)},j[a]=function(b,c){return i.on(a,b,c)},h=function(a,b){var c,d,e,f,g,h;switch(null==b&&(b={}),typeof a){case"object":d=[];for(e in a)f=a[e],d.push(""+e+":	"+f);return d.join("\n");case"string":for(d=a.split("\n"),g=0,h=d.length;h>g;g++)c=d[g],/([^:]+):\s*(.+)/.test(c)&&(b[RegExp.$1]||(b[RegExp.$1]=RegExp.$2));return b}},j.headers=h,g=window.XMLHttpRequest,window.XMLHttpRequest=function(){var j,k,l,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;if(B=new g,0===i.listeners(b).length&&0===i.listeners(a).length)return B;for(z=!1,w={headers:{}},x=null,r=c(),A=c(),v=function(){q.status=x.status,q.statusText=x.statusText,x.headers||(x.headers={})},u=function(){q.responseType=x.type||"",q.response=x.data||null,q.responseText=x.text||x.data||"",q.responseXML=x.xml||null},l=function(){var a,b,c,d;x.status=B.status,x.statusText=B.statusText,c=h(B.getAllResponseHeaders()),d=[];for(a in c)b=c[a],x.headers[a]?d.push(void 0):d.push(x.headers[a]=b);return d},k=function(){return x.type=B.responseType,x.text=B.responseText,x.data=B.response||x.text,x.xml=B.responseXML},n=0,y=function(b){var c,f,g;return p(),c=function(){for(;b>n&&4>n;)q[e]=++n,2===n&&v(),4===n&&(v(),u()),r.fire("readystatechange",t("readystatechange")),4===n&&(r.fire("load",t("load")),r.fire("loadend",t("loadend")))},4>b?c():(f=i.listeners(a),g=function(){var a;if(!f.length)return c();if(a=f.shift(),2===a.length)return a(w,x),g();if(3===a.length)return a(w,x,g);throw d},g(),void 0)},t=function(a){var b,c;if(null!=window.document.createEventObject)return c=window.document.createEventObject(),c.type=a,c;try{return new Event(a)}catch(d){return b=d,{type:a}}},j=function(a){var b,c,d;b={};for(c in a)d=a[c],b[c]=d===B?q:d;return b},p=function(){var a,b,c,d,e;for(e=["timeout"],c=0,d=e.length;d>c;c++)b=e[c],B[b]&&void 0===w[b]&&(w[b]=B[b]);for(b in q)a=q[b],"function"==typeof a&&/^on(\w+)/.test(b)&&r.on(RegExp.$1,a)},B.onreadystatechange=function(){try{2===B[e]&&(l(),y(2))}catch(a){}4===B[e]&&(z=!1,l(),k(),y(4))},I=["abort","progress"],C=0,F=I.length;F>C;C++)o=I[C],B["on"+o]=function(a){return r.fire(o,j(a))};for(D=0,G=f.length;G>D;D++)s=f[D],B.upload[s]=function(a){return function(b){return A.fire(a,j(b))}}(s);for(q={withCredentials:!1,response:null,status:0},q.addEventListener=function(a,b){return r.on(a,b)},q.removeEventListener=r.off,q.dispatchEvent=function(){},q.open=function(a,b,c){w.method=a,w.url=b,w.async=c,y(1)},q.send=function(a){var c,e,g;w.body=a,g=function(){var a,b,c,d,e;d=q.upload;for(s in d)m.call(d,s)&&(b=d[s],b&&f.indexOf(s)>-1&&!function(a,b){return A.on(a,b)}(s,b));x={headers:{}},z=!0,B.open(w.method,w.url,w.async),w.timeout&&(B.timeout=w.timeout),e=w.headers;for(a in e)c=e[a],B.setRequestHeader(a,c);B.send(w.body)},c=i.listeners(b),e=function(){var a,b;if(!c.length)return g();if(a=function(a){return"object"!=typeof a||"number"!=typeof a.status?e():(x=a,y(4),void 0)},b=c.shift(),1===b.length)return a(b(w));if(2===b.length)return b(w,a);throw d},e()},q.abort=function(){z&&B.abort(),r.fire("abort",arguments)},q.setRequestHeader=function(a,b){w.headers[a]=b},q.getResponseHeader=function(a){return x.headers[a]},q.getAllResponseHeaders=function(){return h(x.headers)},q.upload=Object.create({addEventListener:function(a,b){return A.on("on"+a,b)},removeEventListener:function(a,b){return A.off("on"+a,b)},dispatchEvent:function(){}}),E=0,H=f.length;H>E;E++)s=f[E],q.upload[s]=null;return q},window.XMLHttpRequest.Original=g,window.xhook=j}).call(this);
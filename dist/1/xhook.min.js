/* xhook - v1.0.8 - https://github.com/jpillora/xhook
* Jaime Pillora <dev@jpillora.com> -  */

(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m=[].slice,n={}.hasOwnProperty;b="before",a="after",e="readyState",d="Invalid number or parameters. Please see API documentation.",f=["onloadstart","onprogress","onabort","onerror","onload","onloadend"],g="upload.",(l=Array.prototype).indexOf||(l.indexOf=function(a){var b,c,d,e;for(b=d=0,e=this.length;e>d;b=++d)if(c=this[b],c===a)return b;return-1}),c=function(a){var b,c,d;return c={},d=function(a){return c[a]||[]},b={listeners:function(a){return Array.prototype.slice.call(d(a))},on:function(a,b,e){c[a]=d(a),c[a].indexOf(b)>=0||(e=void 0===e?c[a].length:e,c[a].splice(e,0,b))},off:function(a,b){var c;c=d(a).indexOf(b),-1!==c&&d(a).splice(c,1)},fire:function(){var b,c,e,f,g,h;for(c=arguments[0],b=2<=arguments.length?m.call(arguments,1):[],h=d(c),f=0,g=h.length;g>f;f++)e=h[f],e.apply(a,b)}}},j=c(),k={},k[b]=function(a,c){return j.on(b,a,c)},k[a]=function(b,c){return j.on(a,b,c)},i=function(a,b){var c,d,e,f,g,h;switch(null==b&&(b={}),typeof a){case"object":d=[];for(e in a)f=a[e],d.push(""+e+":	"+f);return d.join("\n");case"string":for(d=a.split("\n"),g=0,h=d.length;h>g;g++)c=d[g],/([^:]+):\s*(.+)/.test(c)&&(b[RegExp.$1]||(b[RegExp.$1]=RegExp.$2));return b}},k.headers=i,h=window.XMLHttpRequest,window.XMLHttpRequest=function(){var k,l,m,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;if(B=new h,0===j.listeners(b).length&&0===j.listeners(a).length)return B;for(A=!1,x={headers:{}},y=null,s=c(),w=function(){r.status=y.status,r.statusText=y.statusText,y.headers||(y.headers={})},v=function(){r.responseType=y.type||"",r.response=y.data||null,r.responseText=y.text||y.data||"",r.responseXML=y.xml||null},m=function(){var a,b,c,d;y.status=B.status,y.statusText=B.statusText,c=i(B.getAllResponseHeaders()),d=[];for(a in c)b=c[a],y.headers[a]?d.push(void 0):d.push(y.headers[a]=b);return d},l=function(){return y.type=B.responseType,y.text=B.responseText,y.data=B.response||y.text,y.xml=B.responseXML},o=0,z=function(b){var c,f,g;return q(),c=function(){for(;b>o&&4>o;)r[e]=++o,2===o&&w(),4===o&&(w(),v()),s.fire("readystatechange",u("readystatechange")),4===o&&(s.fire("load",u("load")),s.fire("loadend",u("loadend")))},4>b?c():(f=j.listeners(a),g=function(){var a;if(!f.length)return c();if(a=f.shift(),2===a.length)return a(x,y),g();if(3===a.length)return a(x,y,g);throw d},g(),void 0)},u=function(a){var b,c;if(null!=window.document.createEventObject)return c=window.document.createEventObject(),c.type=a,c;try{return new Event(a)}catch(d){return b=d,{type:a}}},k=function(a){var b,c,d;b={};for(c in a)d=a[c],b[c]=d===B?r:d;return b},q=function(){var a,b,c,d,e;for(e=["timeout"],c=0,d=e.length;d>c;c++)b=e[c],B[b]&&void 0===x[b]&&(x[b]=B[b]);for(b in r)a=r[b],"function"==typeof a&&/^on(\w+)/.test(b)&&s.on(RegExp.$1,a)},B.onreadystatechange=function(){try{2===B[e]&&(m(),z(2))}catch(a){}4===B[e]&&(A=!1,m(),l(),z(4))},I=["abort","progress"],C=0,F=I.length;F>C;C++)p=I[C],B["on"+p]=function(a){return s.fire(p,k(a))};for(D=0,G=f.length;G>D;D++)t=f[D],B.upload[t]=function(a){return function(b){return s.fire(g+a,b)}}(t);for(r={withCredentials:!1,response:null,status:0},r.addEventListener=function(a,b){return s.on(a,b)},r.removeEventListener=s.off,r.dispatchEvent=function(){},r.open=function(a,b,c){x.method=a,x.url=b,x.async=c,z(1)},r.send=function(a){var c,e,h;x.body=a,h=function(){var a,b,c,d,e;d=r.upload;for(t in d)n.call(d,t)&&(b=d[t],b&&f.indexOf(t)>-1&&!function(a,b){return s.on(g+a,b)}(t,b));y={headers:{}},A=!0,B.open(x.method,x.url,x.async),x.timeout&&(B.timeout=x.timeout),e=x.headers;for(a in e)c=e[a],B.setRequestHeader(a,c);B.send(x.body)},c=j.listeners(b),e=function(){var a,b;if(!c.length)return h();if(a=function(a){return"object"!=typeof a||"number"!=typeof a.status?e():(y=a,z(4),void 0)},b=c.shift(),1===b.length)return a(b(x));if(2===b.length)return b(x,a);throw d},e()},r.abort=function(){A&&B.abort(),s.fire("abort",arguments)},r.setRequestHeader=function(a,b){x.headers[a]=b},r.getResponseHeader=function(a){return y.headers[a]},r.getAllResponseHeaders=function(){return i(y.headers)},r.upload=Object.create({addEventListener:function(a,b){return s.on(g+"on"+a,b)},removeEventListener:function(a,b){return s.off(g+"on"+a,b)},dispatchEvent:function(){}}),E=0,H=f.length;H>E;E++)t=f[E],r.upload[t]=null;return r},window.XMLHttpRequest.Original=h,window.xhook=k}).call(this);
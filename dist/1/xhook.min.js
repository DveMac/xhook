/*! xhook - v1.0.8 - 2013-11-27
* Jaime Pillora <dev@jpillora.com>; */

(function(){var a,b,c,d,e,f,g,h,i,j,k=[].slice;b="before",a="after",e="readyState",d="Invalid number or parameters. Please see API documentation.",(j=Array.prototype).indexOf||(j.indexOf=function(a){var b,c,d,e;for(b=d=0,e=this.length;e>d;b=++d)if(c=this[b],c===a)return b;return-1}),c=function(a){var b,c,d;return c={},d=function(a){return c[a]||[]},b={listeners:function(a){return Array.prototype.slice.call(d(a))},on:function(a,b,e){c[a]=d(a),c[a].indexOf(b)>=0||(e=void 0===e?c[a].length:e,c[a].splice(e,0,b))},off:function(a,b){var c;c=d(a).indexOf(b),-1!==c&&d(a).splice(c,1)},fire:function(){var b,c,e,f,g,h;for(c=arguments[0],b=2<=arguments.length?k.call(arguments,1):[],h=d(c),f=0,g=h.length;g>f;f++)e=h[f],e.apply(a,b)}}},h=c(),i={},i[b]=function(a,c){return h.on(b,a,c)},i[a]=function(b,c){return h.on(a,b,c)},g=function(a,b){var c,d,e,f,g,h;switch(null==b&&(b={}),typeof a){case"object":d=[];for(e in a)f=a[e],d.push(""+e+":	"+f);return d.join("\n");case"string":for(d=a.split("\n"),g=0,h=d.length;h>g;g++)c=d[g],/([^:]+):\s*(.+)/.test(c)&&(b[RegExp.$1]||(b[RegExp.$1]=RegExp.$2));return b}},i.headers=g,f=window.XMLHttpRequest,window.XMLHttpRequest=function(){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;if(x=new f,0===h.listeners(b).length&&0===h.listeners(a).length)return x;for(w=!1,t={headers:{}},u=null,p=c(),s=function(){o.status=u.status,o.statusText=u.statusText,u.headers||(u.headers={})},r=function(){o.responseType=u.type||"",o.response=u.data||null,o.responseText=u.text||u.data||"",o.responseXML=u.xml||null},k=function(){var a,b,c,d;u.status=x.status,u.statusText=x.statusText,c=g(x.getAllResponseHeaders()),d=[];for(a in c)b=c[a],u.headers[a]?d.push(void 0):d.push(u.headers[a]=b);return d},j=function(){return u.type=x.responseType,u.text=x.responseText,u.data=x.response||u.text,u.xml=x.responseXML},l=0,v=function(b){var c,f,g;return n(),c=function(){for(;b>l&&4>l;)o[e]=++l,2===l&&s(),4===l&&(s(),r()),p.fire("readystatechange",q("readystatechange")),4===l&&(p.fire("load",q("load")),p.fire("loadend",q("loadend")))},4>b?c():(f=h.listeners(a),g=function(){var a;if(!f.length)return c();if(a=f.shift(),2===a.length)return a(t,u),g();if(3===a.length)return a(t,u,g);throw d},g(),void 0)},q=function(a){var b;if(null!=window.document.createEventObject)return b=window.document.createEventObject(),b.type=a,b;try{return new Event(a)}catch(c){return{type:a}}},i=function(a){var b,c,d;b={};for(c in a)d=a[c],b[c]=d===x?o:d;return b},n=function(){var a,b,c,d,e;for(e=["timeout"],c=0,d=e.length;d>c;c++)b=e[c],x[b]&&void 0===t[b]&&(t[b]=x[b]);for(b in o)a=o[b],"function"==typeof a&&/^on(\w+)/.test(b)&&p.on(RegExp.$1,a)},x.onreadystatechange=function(){try{2===x[e]&&(k(),v(2))}catch(a){}4===x[e]&&(w=!1,k(),j(),v(4))},A=["abort","progress"],y=0,z=A.length;z>y;y++)m=A[y],x["on"+m]=function(a){return p.fire(m,i(a))};return o={withCredentials:!1,response:null,status:0},o.addEventListener=function(a,b){return p.on(a,b)},o.removeEventListener=p.off,o.dispatchEvent=function(){},o.open=function(a,b,c){t.method=a,t.url=b,t.async=c,v(1)},o.send=function(a){var c,e,f;t.body=a,f=function(){var a,b,c;u={headers:{}},w=!0,x.open(t.method,t.url,t.async),t.timeout&&(x.timeout=t.timeout),c=t.headers;for(a in c)b=c[a],x.setRequestHeader(a,b);x.send(t.body)},c=h.listeners(b),e=function(){var a,b;if(!c.length)return f();if(a=function(a){return"object"!=typeof a||"number"!=typeof a.status?e():(u=a,v(4),void 0)},b=c.shift(),1===b.length)return a(b(t));if(2===b.length)return b(t,a);throw d},e()},o.abort=function(){w&&x.abort(),p.fire("abort",arguments)},o.setRequestHeader=function(a,b){t.headers[a]=b},o.getResponseHeader=function(a){return u.headers[a]},o.getAllResponseHeaders=function(){return g(u.headers)},o},window.xhook=i}).call(this);